<div class="checkout-wrapper">
    <h1>צ'קאאוט</h1>
  
    <section class="checkout-section">
      <h2>כתובת למשלוח</h2>
      <div class="address-list">
        <div *ngFor="let address of addresses" 
             class="address-item" 
             [class.selected]="address === selectedAddress"
             (click)="selectAddress(address)">
          <p>{{ address.name }}</p>
          <p>{{ address.street }}, {{ address.city }}</p>
        </div>
      </div>
      <button (click)="toggleAddressForm()">הוסף כתובת חדשה</button>
      <button *ngIf="selectedAddress" (click)="updateAddressToCheckout()">בחירת כתובת זו למשלוח</button>

      <!-- <form *ngIf="showAddressForm" (ngSubmit)="addAddress()" class="address-form">
         //להחליף לפורם 
        <input type="text" [(ngModel)]="newAddress.addressLine1" name="addressLine1" placeholder="כתובת 1" required />
        <input type="text" [(ngModel)]="newAddress.addressLine2" name="addressLine2" placeholder="כתובת 2" required />
        <input type="text" [(ngModel)]="newAddress.city" name="city" placeholder="עיר" required />
        <input type="text" [(ngModel)]="newAddress.country" name="country" placeholder="ארץ" required />
        <input type="text" [(ngModel)]="newAddress.state" name="state" placeholder="מדינה" required />
        <input type="text" [(ngModel)]="newAddress.zipCode" name="zipCode" placeholder="מיקוד" required />
        <button type="submit">שמור כתובת</button>
      </form> -->

      <form [formGroup]="addressForm" (ngSubmit)="addAddress()" class="address-form">
        <!-- כתובת 1 -->
        <div>
          <label for="addressLine1">כתובת 1:</label>
          <input 
            id="addressLine1" 
            formControlName="addressLine1" 
            placeholder="כתובת 1" 
            aria-required="true" 
            required />
          <span *ngIf="addressForm.get('addressLine1')?.invalid && addressForm.get('addressLine1')?.touched" 
                aria-live="polite" 
                class="error">
            שדה זה נדרש.
          </span>
        </div>
      
        <!-- כתובת 2 -->
        <div>
          <label for="addressLine2">כתובת 2:</label>
          <input 
            id="addressLine2" 
            formControlName="addressLine2" 
            placeholder="כתובת 2" 
            aria-describedby="addressLine2-help" />
          <small id="addressLine2-help" class="help-text">שדה אופציונלי</small>
        </div>
      
        <!-- עיר -->
        <div>
          <label for="city">עיר:</label>
          <input 
            id="city" 
            formControlName="city" 
            placeholder="עיר" 
            aria-required="true" 
            required />
          <span *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched" 
                aria-live="polite" 
                class="error">
            שדה זה נדרש.
          </span>
        </div>
      
        <!-- מדינה -->
        <div>
          <label for="country">ארץ:</label>
          <input 
            id="country" 
            formControlName="country" 
            placeholder="ארץ" 
            aria-required="true" 
            required />
          <span *ngIf="addressForm.get('country')?.invalid && addressForm.get('country')?.touched" 
                aria-live="polite" 
                class="error">
            שדה זה נדרש.
          </span>
        </div>
      
        <!-- מחוז -->
        <div>
          <label for="state">מדינה:</label>
          <input 
            id="state" 
            formControlName="state" 
            placeholder="מדינה" />
        </div>
      
        <!-- מיקוד -->
        <div>
          <label for="zipCode">מיקוד:</label>
          <input 
            id="zipCode" 
            formControlName="zipCode" 
            placeholder="מיקוד" 
            aria-required="true" 
            required />
          <span *ngIf="addressForm.get('zipCode')?.invalid && addressForm.get('zipCode')?.touched" 
                aria-live="polite" 
                class="error">
            יש להזין מיקוד תקין.
          </span>
        </div>
      
        <!-- כפתור שליחה -->
        <button 
          type="submit" 
          [disabled]="addressForm.invalid" 
          [attr.aria-disabled]="addressForm.invalid ? 'true' : 'false'">
          שמור כתובת
        </button>
      </form>

    </section>
  
    <section class="checkout-section">
      <h2>אמצעי תשלום</h2>
      <select [(ngModel)]="selectedPaymentMethod">
        <option *ngFor="let method of paymentMethods" [value]="method">{{ method }}</option>
      </select>
    </section>
  
    <section class="checkout-section cart">
      <h2>סיכום ההזמנה</h2>
      <div class="cart-item" *ngFor="let item of cartItems">
        <div class="cart-item-details">
          <h3>{{ item.name }}</h3>
          <p>כמות: {{ item.quantity }}</p>
        </div>
        <p class="cart-item-price">{{ item.price * item.quantity }} ₪</p>
      </div>
      <div class="cart-total">
        <h3>סה"כ לתשלום:</h3>
        <p>{{ calculateTotal() }} ₪</p>
      </div>
    </section>
  
    <button class="complete-checkout" (click)="completeCheckout()">סיום תשלום</button>
  </div>